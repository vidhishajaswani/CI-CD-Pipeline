---
- name: Create analysis directory
  file:
    name: analysis
    state: directory
  
- name: Copy the package.json onto the deployment server
  template:
    src: templates/package.json
    dest: {{vagrant_home}}/analysis/package.json

- name: Copy the analysis code-2 onto the deployment server
  template:
    src: templates/analysis.js.j2
    dest: {{vagrant_home}}/analysis/analysis.js

- name: npm install the required packages
  command: npm install
  args:
    chdir: {{vagrant_home}}/analysis/ 
  become: true

# This task must be called in some playbook that relates to checkbox job build - TO DO
- name: Start the analysis
  command: node analysis.js > checkboxCA.log
  args:
    chdir: {{vagrant_home}}/analysis/